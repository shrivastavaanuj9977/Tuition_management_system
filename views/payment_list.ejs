<% var pageTitle = "Students"; %>
<% include partials/header %>

    <!-- Main Content -->
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-credit-card"></i>
                Payment Management
            </h1>
            <a href="/fees/add" class="add-btn">
                <i class="fas fa-plus"></i> Add Payment
            </a>
        </div>

        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon paid">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="stat-content">
                    <h3>Paid Payments</h3>
                    <div class="value">
                        <%= paidCount || 0 %>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon pending">
                    <i class="fas fa-hourglass-half"></i>
                </div>
                <div class="stat-content">
                    <h3>Pending Payments</h3>
                    <div class="value">
                        <%= pendingCount || 0 %>
                    </div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon total">
                    <i class="fas fa-coins"></i>
                </div>
                <div class="stat-content">
                    <h3>Total Revenue</h3>
                    <div class="value">₹<%= totalRevenue || 0 %>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Box -->
        <div class="search-box">
            <form action="/fees/search" method="GET" class="search-form">
                <input type="text" name="query" placeholder="Search by student name or reference number..."
                    value="<%= typeof query !== 'undefined' ? query : '' %>">
                <button type="submit" class="search-btn">
                    <i class="fas fa-search"></i> Search
                </button>
                <a href="/fees" style="text-decoration: none;">
                    <button type="button" class="clear-btn" onclick="window.location.href='/fees'">
                        <i class="fas fa-times"></i> Clear
                    </button>
                </a>
            </form>
        </div>

        <!-- Payments Table -->
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Student Name</th>
                        <th>Amount</th>
                        <th>Payment Date</th>
                        <th>Status</th>
                        <th>Payment Method</th>
                        <th>Reference No.</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% if (payments && payments.length> 0) { %>
                        <% payments.forEach(payment=> { %>
                            <tr>
                                <td>#<%= payment.id %>
                                </td>
                                <td>
                                    <span class="student-name">
                                        <%= payment.student_name || 'N/A' %>
                                    </span>
                                </td>
                                <td>
                                    <span class="amount">₹<%= parseFloat(payment.amount).toFixed(2) %></span>
                                </td>
                                <td>
                                    <%= new Date(payment.payment_date).toLocaleDateString() %>
                                </td>
                                <td>
                                    <span class="badge <%= 'badge-' + payment.status.toLowerCase() %>">
                                        <%= payment.status %>
                                    </span>
                                </td>
                                <td>
                                    <%= payment.payment_method %>
                                </td>
                                <td>
                                    <%= payment.reference_no || '-' %>
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="/fees/edit/<%= payment.id %>" class="btn-small btn-edit">
                                            <i class="fas fa-edit"></i> Edit
                                        </a>
                                        <a href="/fees/delete/<%= payment.id %>" class="btn-small btn-delete"
                                            onclick="return confirm('Are you sure?')">
                                            <i class="fas fa-trash"></i> Delete
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            <% }); %>
                                <% } else { %>
                                    <tr>
                                        <td colspan="8" class="no-data">
                                            <i class="fas fa-inbox"></i>
                                            <p>No payments found. <a href="/fees/add" style="color: #667eea;">Add a new
                                                    payment</a></p>
                                        </td>
                                    </tr>
                                    <% } %>
                </tbody>
            </table>
        </div>
    </div>

 
        <% include partials/footer %>